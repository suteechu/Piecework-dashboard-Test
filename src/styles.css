:root{
  --bg:#f5f7fb; --bg2:#eef3ff; --text:#0f172a; --muted:#5f6b7a;
  --card:#ffffff; --border:#e8edf3;
  --accent:#2563eb; --accent-2:#00b3a4; --ring:rgba(37,99,235,.16);
}
.theme-dark{
  --bg:#0b1220; --bg2:#0f172a; --text:#e2e8f0; --muted:#94a3b8;
  --card:#0f172a; --border:#1f2a44;
  --accent:#60a5fa; --accent-2:#22d3ee; --ring:rgba(96,165,250,.18);
}
*{box-sizing:border-box}
html,body,#root{height:100%}
body{
  margin:0;
  background: radial-gradient(1600px 800px at -10% -10%, var(--bg2) 0%, var(--bg) 35%, #f6f8fb 100%);
  color: var(--text);
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, sans-serif;
  -webkit-font-smoothing: antialiased;
}
.theme-dark body{
  background: radial-gradient(1600px 800px at -10% -10%, var(--bg2) 0%, var(--bg) 35%, #0b1320 100%);
}

/* Layout */
.container{max-width:1280px;margin:32px auto;padding:0 24px}
.header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:14px}
.title{font-size:32px;font-weight:800;letter-spacing:.2px}
.header-meta{display:flex;align-items:center;gap:12px;color:#64748b;font-size:12px}

/* Toolbar */
.toolbar{
  display:flex;justify-content:space-between;align-items:center;flex-wrap:nowrap;
  gap:16px;margin:12px 0 18px;
}
.filters{display:flex;align-items:center;gap:12px;flex:1;min-width:0}
.filters .control{flex:0 0 auto;min-width:160px}
label{font-size:12px;color:var(--muted);font-weight:700;text-transform:uppercase;letter-spacing:.4px;white-space:nowrap}
select,input[type="range"]{background:var(--card);color:var(--text);border:1px solid var(--border);border-radius:12px;padding:12px;outline:none;transition:.15s border,.15s box-shadow}
select:focus,input[type="range"]:focus{border-color:var(--accent);box-shadow:0 0 0 6px var(--ring)}
.actions{display:flex;align-items:center;gap:8px;flex-wrap:nowrap}

/* Compact toolbar */
.toolbar.compact{gap:10px;margin:8px 0 12px}
.toolbar.compact .filters{gap:10px}
.toolbar.compact .filters .control{min-width:130px}
.toolbar.compact label{font-size:11px;letter-spacing:.2px}
.toolbar.compact select{padding:8px 10px;border-radius:10px;font-size:13px}
.toolbar.compact .filters .control[style]{min-width:200px !important}
.toolbar.compact input[type="range"]{height:4px}
.toolbar.compact .actions{gap:6px}
.toolbar.compact .actions .btn{height:32px;padding:0 10px;font-size:13px}
.toolbar.compact .seg-group{padding:4px}
.toolbar.compact .seg-btn{width:34px;height:34px}

/* range control (แก้ทับกัน) */
.control-range{ display:flex; flex-direction:column; }
.control-range .label-inline{
  margin-bottom:4px;
  font-size:12px; font-weight:700; color:var(--muted);
}
.range-wrap{ display:flex; align-items:center; gap:8px; }

/* Slider */
input[type="range"]{height:6px;padding:0}
input[type="range"]::-webkit-slider-runnable-track{height:6px;background:#e5ecf5;border-radius:999px}
.theme-dark input[type="range"]::-webkit-slider-runnable-track{background:#1e293b}
input[type="range"]::-webkit-slider-thumb{
  -webkit-appearance:none;appearance:none;width:18px;height:18px;border-radius:50%;
  background:conic-gradient(from 0deg, var(--accent), var(--accent-2));
  border:2px solid var(--card); box-shadow:0 2px 8px rgba(0,0,0,.25); margin-top:-6px;
}
input[type="range"]::-moz-range-track{height:6px;background:#e5ecf5;border-radius:999px}
.theme-dark input[type="range"]::-moz-range-track{background:#1e293b}
input[type="range"]::-moz-range-thumb{
  width:18px;height:18px;border:none;border-radius:50%;
  background:conic-gradient(from 0deg,var(--accent),var(--accent-2));
  box-shadow:0 2px 8px rgba(0,0,0,.25);
}

/* Buttons */
.btn{
  display:inline-flex;align-items:center;justify-content:center;gap:8px;
  height:42px;padding:0 18px;border:1px solid var(--border);
  background:var(--card);color:var(--text);
  border-radius:9999px;cursor:pointer;font-size:14px;font-weight:700;letter-spacing:.1px;
  transition:.15s transform,.15s box-shadow,.15s border,.15s background;user-select:none;
}
.btn:hover{border-color:var(--accent);box-shadow:0 6px 20px rgba(37,99,235,.18)}
.btn:active{transform:translateY(1px)}
.btn:focus-visible{outline:none;box-shadow:0 0 0 6px var(--ring)}
.btn-primary{background:linear-gradient(180deg,var(--accent),#1e4ed8);color:#fff;border-color:#1e4ed8}
.theme-dark .btn-primary{background:linear-gradient(180deg,#3b82f6,#1e40af);border-color:#1e40af}
.btn-icon{display:inline-flex;align-items:center;justify-content:center;margin-right:6px;font-size:15px;line-height:1}
.filebtn{position:relative;overflow:hidden}
.filebtn input[type="file"]{position:absolute;inset:0;opacity:0;cursor:pointer}

/* Segmented (Import/Export icon-only) */
.seg-info{display:flex;align-items:center;gap:8px;color:var(--muted);font-size:13px}
.seg-info-ico{font-size:15px;line-height:1}
.seg-group{display:inline-flex;gap:8px;padding:6px;background:#eef3ff;border:1px solid #e6ecf6;border-radius:9999px}
.theme-dark .seg-group{background:#0b1220;border-color:#1f2a44}
.seg-btn{
  width:40px;height:40px;padding:0;border-radius:9999px;
  display:inline-flex;align-items:center;justify-content:center;
  background:var(--card);color:var(--text);border:1px solid transparent;
  transition:.15s box-shadow,.15s background,.15s color,.15s transform;font-size:0;
}
.seg-btn:hover{box-shadow:0 6px 20px rgba(37,99,235,.12)}
.seg-btn:active{transform:translateY(1px)}
.seg-btn.is-active{background:#0f172a;color:#fff;box-shadow:0 10px 28px rgba(15,23,42,.22)}
.theme-dark .seg-btn.is-active{background:#1f2937}
.seg-btn svg{margin:0}

/* KPI grid */
.kpis{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin:8px 0 22px}
.kpis-2{display:grid;grid-template-columns:repeat(2,1fr);gap:16px;margin:8px 0 22px}
.kpis-1{display:grid;grid-template-columns:1fr;gap:16px;margin:8px 0 22px}

/* KPI card & sparkline */
.kpi{
  background: linear-gradient(180deg,var(--card), color-mix(in srgb,var(--card) 60%, #fbfdff 40%));
  border:1px solid var(--border); border-radius:18px;
  padding:28px 20px; box-shadow:0 12px 30px rgba(15,23,42,.06);
  position:relative; isolation:isolate; overflow:hidden;
}
.theme-dark .kpi{box-shadow:0 12px 30px rgba(2,8,23,.6)}
.kpi::after{
  content:""; position:absolute; left:0; right:0; bottom:0; height:4px;
  background: linear-gradient(90deg,var(--accent), var(--accent-2));
  filter: saturate(1.1); animation: kpi-bar 6s linear infinite; background-size: 200% 100%;
}
@keyframes kpi-bar { 0%{background-position:0% 0} 100%{background-position:200% 0} }

.kpi-elevated{box-shadow:0 12px 30px rgba(15,23,42,.06),0 0 0 rgba(59,130,246,0);transition:box-shadow .25s ease, transform .2s ease}
.kpi-elevated:hover{transform:translateY(-1px);box-shadow:0 16px 34px rgba(15,23,42,.08),0 0 0 6px rgba(59,130,246,.06)}

.kpi .label{color:var(--muted);font-size:12px;font-weight:700}
.kpi .value{font-size:42px;font-weight:800;letter-spacing:.3px;margin-top:6px;font-variant-numeric:tabular-nums;text-align:left}
.kpi-head{display:flex;align-items:center;justify-content:space-between;gap:12px}
.kpi-meta{display:flex;flex-direction:column}
.kpi-icon{width:44px;height:44px;border-radius:14px;display:grid;place-items:center;background:linear-gradient(180deg,#eef3ff,#ffffff);border:1px solid var(--border);color:#334155;box-shadow:inset 0 1px 0 rgba(255,255,255,.8)}
.theme-dark .kpi-icon{background:linear-gradient(180deg,#0b1220,#0f172a);border-color:#1f2a44;color:#94a3b8}

/* KPI flex layout */
.kpi-flex{ display:flex; align-items:flex-end; gap:16px; }
.kpi-left{ flex:0 0 auto; min-width:260px; }
.kpi-right{
  flex:1 1 0; min-width:220px;
  display:flex; align-items:flex-end;
}
/* กล่อง sparkline + เส้นคั่นซ้าย-ขวา */
.spark-box{
  position:relative; width:100%; height:72px;
  padding:0 10px; display:flex; align-items:flex-end; border-radius:10px;
}
.spark-box::before,.spark-box::after{
  content:""; position:absolute; top:0; bottom:0; width:2px;
  background:rgba(15,23,42,.08); border-radius:2px;
}
.spark-box::before{ left:0 } .spark-box::after{ right:0 }

.kpi-badges{display:flex;gap:8px;align-items:center;margin-top:10px;flex-wrap:wrap}
.badge{padding:6px 10px;border-radius:999px;font-size:12px;font-weight:700;color:var(--text);background:#eef3ff;border:1px solid #e6ecf6}
.badge.pos{color:#065f46;background:#ecfdf5;border-color:#d1fae5}
.badge.neg{color:#991b1b;background:#fef2f2;border-color:#fee2e2}
.badge.muted{color:#475569;background:#f1f5f9;border-color:#e2e8f0}
.theme-dark .badge{background:#0b1220;border-color:#1f2a44;color:#cbd5e1}
.theme-dark .badge.muted{background:#0b1220;color:#94a3b8;border-color:#1f2a44}

/* Card & charts */
.card{background:var(--card);border:1px solid var(--border);border-radius:18px;padding:16px;box-shadow:0 14px 34px rgba(15,23,42,.07);margin-bottom:16px}
.card h3{margin:2px 0 10px 4px;font-size:14px;font-weight:700;color:var(--muted);letter-spacing:.2px}
.row{display:flex;gap:16px;flex-wrap:wrap}
.col{flex:1;min-width:420px}
.row.charts{display:flex;gap:16px;flex-wrap:nowrap}
.row.charts .col{flex:1 1 0;min-width:0}

/* Plotly modebar */
.js-plotly-plot .modebar{border-radius:10px !important;background:rgba(15,23,42,.06) !important;backdrop-filter:saturate(1.2) blur(4px)}
.js-plotly-plot .modebar-btn{filter:contrast(.9);opacity:.9}

/* Responsive */
@media (max-width: 1200px){
  .seg-info{ display:none; }
}
